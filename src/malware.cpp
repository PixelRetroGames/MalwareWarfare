#include "malware.h"

void Malware::Load(char *filename,int _id)
{
 id=_id;

 char path_to_image[TEXT_LENGTH_MAX],path_to_attack_image[TEXT_LENGTH_MAX],path_to_dying_image[TEXT_LENGTH_MAX],name[TEXT_LENGTH_MAX];
 char path_to_splash_image[TEXT_LENGTH_MAX],path_to_walking_image[TEXT_LENGTH_MAX];
 FILE *in=fopen(filename,"r");
 const int NUMBER_OF_VARS=7;
 int *vars[NUMBER_OF_VARS]={&number_of_frames,&damage,&health,&radius,&cooldown_time,&ram_reward,&phase_change_delay};
 const char *vars_names[NUMBER_OF_VARS]={"number_of_frames","damage","health","radius","cooldown","ram_reward","phase_change_delay"};
 const int NUMBER_OF_STRINGS=6;
 char *strings[NUMBER_OF_STRINGS]={path_to_image,path_to_attack_image,path_to_dying_image,path_to_walking_image,path_to_splash_image,name};
 const char *str_names[NUMBER_OF_STRINGS]={"image","attack_image","dying_image","walking_image","splash_image","name"};
 Parse_file(in,
            NUMBER_OF_VARS,vars,vars_names,
            NUMBER_OF_STRINGS,strings,str_names);
 fclose(in);

 Virus::Load_images(path_to_image,path_to_attack_image,path_to_dying_image,path_to_walking_image,path_to_splash_image);
 Create_menu_image(name);
 is_cool=true;
}

void Malware::Create_menu_image(char *name)
{
 //menu_image=Create_Transparent_Texture(image->w*2,image->h*2);
 //Apply_Stretched_Texture(0,0,menu_image->w,menu_image->h,image,menu_image);
 Texture *cooldown_image,*damage_image,*health_image,*name_image,*range_image;
 char aux[TEXT_LENGTH_MAX],aux1[TEXT_LENGTH_MAX];
 name_image=Create_TTF_Texture(MENU_FONT_SMALL,name,VIRUS_NAME_COLOR);
 strcpy(aux1,"Cooldown: ");
 itoa(cooldown_time,aux);
 strcat(aux1,aux);
 cooldown_image=Create_TTF_Texture(MENU_FONT_SMALL,aux1,VIRUS_COOLDOWN_COLOR);
 strcpy(aux1,"Damage: ");
 itoa(damage,aux);
 strcat(aux1,aux);
 damage_image=Create_TTF_Texture(MENU_FONT_SMALL,aux1,VIRUS_DAMAGE_COLOR);
 strcpy(aux1,"Health: ");
 itoa(health,aux);
 strcat(aux1,aux);
 health_image=Create_TTF_Texture(MENU_FONT_SMALL,aux1,VIRUS_HEALTH_COLOR);
 strcpy(aux1,"Radius: ");
 itoa(radius,aux);
 strcat(aux1,aux);
 range_image=Create_TTF_Texture(MENU_FONT_SMALL,aux1,MALWARE_RADIUS_COLOR);
 menu_description=Create_Transparent_Texture(MENU_OPTION_BACKGROUND->w-2*PIXELS_PER_INGAME_UNIT,name_image->h+cooldown_image->h+damage_image->h+health_image->h+range_image->h);
 Apply_Texture((menu_description->w-name_image->w)/2,0,name_image,menu_description);
 Apply_Texture((menu_description->w-damage_image->w)/2,name_image->h,damage_image,menu_description);
 Apply_Texture((menu_description->w-health_image->w)/2,name_image->h+damage_image->h,health_image,menu_description);
 Apply_Texture((menu_description->w-range_image->w)/2,name_image->h+damage_image->h+health_image->h,range_image,menu_description);
 Apply_Texture((menu_description->w-cooldown_image->w)/2,name_image->h+damage_image->h+health_image->h+range_image->h,cooldown_image,menu_description);
 Destroy_Texture(cooldown_image);
 Destroy_Texture(damage_image);
 Destroy_Texture(name_image);
 Destroy_Texture(range_image);
}

int Malware::Get_radius()
{
 return radius;
}
