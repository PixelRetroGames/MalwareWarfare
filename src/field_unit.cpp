#include "field_unit.h"

const int angles[]={-90,0,90,180};
const int dirx[]={0,1,0,-1};
const int diry[]={1,0,-1,0};
const int ANIMATION_SMOOTHNESS=4;

void Field_unit::Print(int x,int y,Texture *_screen)
{
 if(map_x==0 || map_y==0 || map_x==ARENA_SIZE-1 || map_y==ARENA_SIZE-1)
    phase=ANIMATION_SMOOTHNESS;
 unit->Print(x+(map_y-diry[angle])*PIXELS_PER_INGAME_UNIT+diry[angle]*(PIXELS_PER_INGAME_UNIT/ANIMATION_SMOOTHNESS*phase),
             y+(map_x-dirx[angle])*PIXELS_PER_INGAME_UNIT+dirx[angle]*(PIXELS_PER_INGAME_UNIT/ANIMATION_SMOOTHNESS*phase)
             ,angles[angle],_screen);
 Update_phase();
}

const int PHASE_CHANGE_DELAY=40;

void Field_unit::Update_phase()
{
 if(phase_timer.get_ticks()>PHASE_CHANGE_DELAY)
    {
     phase++;
     if(phase>ANIMATION_SMOOTHNESS)
        phase=ANIMATION_SMOOTHNESS;
     phase_timer.start();
    }
}

void Field_unit::Set_map_pos(int x,int y)
{
 map_x=x;
 map_y=y;
 phase=0;
 phase_timer.start();
}

void Field_unit::Set_map_pos(std::pair<int,int> pos)
{
 map_x=pos.first;
 map_y=pos.second;
}

void Field_unit::Set_damage_taken(int _damage_taken)
{
 damage_taken=_damage_taken;
}

void Field_unit::Set_unit(Combat_unit *_unit)
{
 unit=_unit;
}

void Field_unit::Set_angle(int _angle)
{
 angle=_angle;
}

std::pair<int,int> Field_unit::Get_map_pos()
{
 return std::make_pair(map_x,map_y);
}

Combat_unit *Field_unit::Get_combat_unit()
{
 return unit;
}

int Field_unit::Get_phase()
{
 return phase;
}

bool Field_unit::Phase_finished()
{
 return phase==ANIMATION_SMOOTHNESS;
}
