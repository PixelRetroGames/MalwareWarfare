#include "attacker.h"

char PATH_TO_ALL_VIRUSES[]={"res/virus/all.mwav"};

void Attacker::Load(int _id)
{
 Set_id(_id);
 FILE *in=fopen(PATH_TO_ALL_VIRUSES,"r");
 for(int i=0;i<4;i++)
     {
      char aux[TEXT_LENGTH_MAX];
      fgets(aux,sizeof aux,in);
      int sq=strlen(aux);
      if(aux[sq-1]=='\n')
         aux[sq-1]=NULL;
      unit[i].Load(aux,i);
     }
 fclose(in);
 char aux[TEXT_LENGTH_MAX];
 strcpy(aux,"P");
 strcat(aux,_id==1?"1":"2");
 strcat(aux," - hacker");
 player_image=Create_TTF_Texture(MENU_FONT_BIG,aux,ATTACKER_ID_COLOR);
 event_timer.start();
}

void Attacker::Reset()
{
 for(int i=0;i<4;i++)
     unit[i].Reset();
 event_timer.start();
}

Virus *Attacker::Get_virus(int _id)
{
 return Get_unit(_id);
}

bool Attacker::Can_cast(int _id)
{
 return unit[_id].Is_cool();
}

int Attacker::Handle_Events()
{
 int ret=Player::Handle_Events();
 if(ret!=-1)
    unit[ret].Start_cooldown();
 return ret;
}

void Attacker::Print_info(int x,int y,Texture *_screen)
{
 Apply_Texture(x,y,MENU_BACKGROUND_ATTACKER,_screen);
 Player::Print_info(x,y,_screen);
 Apply_Texture(x+(MENU_OPTION_BACKGROUND->w-player_image->w)/2,y+(_screen->h-NUMBER_OF_UNITS_ON_PAGE*MENU_OPTION_BACKGROUND->h-player_image->h)/2-32,player_image,_screen);
}
