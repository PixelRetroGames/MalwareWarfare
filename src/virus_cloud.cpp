#include "virus_cloud.h"

void Virus_cloud::Load(char *filename,int _id)
{
 id=_id;

 char path_to_image[TEXT_LENGTH_MAX],path_to_attack_image[TEXT_LENGTH_MAX],path_to_dying_image[TEXT_LENGTH_MAX],name[TEXT_LENGTH_MAX];
 char path_to_splash_image[TEXT_LENGTH_MAX],path_to_walking_image[TEXT_LENGTH_MAX];
 char description_text[TEXT_LENGTH_MAX];
 FILE *in=fopen(filename,"r");
 const int NUMBER_OF_VARS=7;
 int *vars[NUMBER_OF_VARS]={&number_of_frames,&damage,&health,&cooldown_time,&spawn_delay,&phase_change_delay,&ram_cost};
 const char *vars_names[NUMBER_OF_VARS]={"number_of_frames","damage","health","cooldown_time","spawn_delay","phase_change_delay","ram_cost"};
 const int NUMBER_OF_STRINGS=7;
 char *strings[NUMBER_OF_STRINGS]={path_to_image,path_to_attack_image,path_to_dying_image,path_to_walking_image,path_to_splash_image,name,description_text};
 const char *str_names[NUMBER_OF_STRINGS]={"image","attack_image","dying_image","walking_image","splash_image","name","description_text"};
 Parse_file(in,
            NUMBER_OF_VARS,vars,vars_names,
            NUMBER_OF_STRINGS,strings,str_names);
 fclose(in);

 animations[STATE_IDLE].Load(path_to_image);
 animations[STATE_ATTACKING].Load(path_to_attack_image);
 animations[STATE_DYING].Load(path_to_dying_image);
 animations[STATE_WALKING].Load(path_to_walking_image);
 menu_image=Load_Transparent_Texture(path_to_splash_image);
 Create_menu_image(name,description_text);
 is_cool=true;
}

void Virus_cloud::Print(bool taking_damage,int _frame,int x,int y,int angle,int state,Texture *_screen)
{
 Apply_Rotated_Texture(animations[state].Get_image(),{_frame*3*PIXELS_PER_INGAME_UNIT,0,3*PIXELS_PER_INGAME_UNIT,PIXELS_PER_INGAME_UNIT},
                       _screen,{x-PIXELS_PER_INGAME_UNIT,y,3*PIXELS_PER_INGAME_UNIT,PIXELS_PER_INGAME_UNIT},angle);
}

int Virus_cloud::Get_spawn_delay()
{
 return spawn_delay;
}
